<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>YTClipper</title>
  <meta name="application-name" content="YTClipper" />
  <meta name="apple-mobile-web-app-title" content="YTClipper" />
  <meta name="theme-color" content="#0b0f14" />
  <link rel="icon" href="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Crect%20x%3D%223%22%20y%3D%225%22%20width%3D%2218%22%20height%3D%2214%22%20rx%3D%223%22%20fill%3D%22%23111824%22%20stroke%3D%22%2348d0ff%22%20stroke-width%3D%221.6%22/%3E%3Cpath%20d%3D%22M10%209v6l6-3z%22%20fill%3D%22%2348d0ff%22/%3E%3C/svg%3E" />
  <link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
  <div class="wrap">
    <div class="grid">
      <div class="card">
        <h2>
          <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <rect x="3" y="5" width="18" height="14" rx="2"></rect>
            <path d="M10 9l5 3-5 3V9z"></path>
          </svg>
          Video & Heatmap
        </h2>
        <div class="muted" style="margin:-6px 0 12px 0">Tempel URL, lalu ambil Most Replayed untuk auto-segmen (inti auto-clipper).</div>
        <label title="Tempel link YouTube (watch/shorts/youtu.be).">YouTube URL</label>
        <input id="url" type="text" placeholder="https://www.youtube.com/watch?v=..." />
        <div style="height:10px"></div>
        <div class="row">
          <button class="btn" id="openYT" title="Buka link di tab baru.">
            <span class="btnLabel">
              <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M14 3h7v7"></path>
                <path d="M10 14L21 3"></path>
                <path d="M21 14v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h6"></path>
              </svg>
              <span>Open</span>
            </span>
          </button>
          <button class="btn primary" id="loadHeatmap" title="Ambil segmen otomatis dari Most Replayed.">
            <span class="btnLabel">
              <span class="spinner" id="heatmapSpin"></span>
              <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M3 12h6l3-9 3 18 3-9h3"></path>
              </svg>
              <span id="heatmapText">Load Heatmap</span>
            </span>
          </button>
        </div>
        <div style="height:10px"></div>
        <div class="muted" id="info">Durasi: -</div>
        <div style="height:12px"></div>
        <div class="player">
          <div id="player"></div>
          <svg id="mainCropOverlay" class="cropOverlay" viewBox="0 0 100 100" preserveAspectRatio="none" aria-hidden="true"></svg>
        </div>
        <div style="height:10px"></div>
        <div class="row">
          <button class="btn" id="play" title="Play/Pause preview.">
            <span class="btnLabel">
              <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M8 5v14l11-7z"></path>
              </svg>
              <span>Play/Pause</span>
            </span>
          </button>
          <button class="btn" id="stop" title="Stop dan kembali ke 0.">
            <span class="btnLabel">
              <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <rect x="7" y="7" width="10" height="10" rx="2"></rect>
              </svg>
              <span>Stop</span>
            </span>
          </button>
          <input id="previewSecs" type="number" min="5" max="600" step="1" title="Preview pertama N detik." />
          <button class="btn" id="playPreview" title="Mainkan dari 0 sampai preview detik.">
            <span class="btnLabel">
              <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M22 12a10 10 0 1 1-3-7.2"></path>
                <path d="M22 4v6h-6"></path>
              </svg>
              <span>Play Preview</span>
            </span>
          </button>
        </div>
        <div style="height:10px"></div>
        <label title="Timeline untuk navigasi preview.">Timeline</label>
        <input id="timeline" type="range" min="0" max="0" value="0" />
        <div class="muted"><span id="tCur">00:00</span> / <span id="tDur">00:00</span></div>

        <div class="divider"></div>
        <div class="sectionTitle">
          <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M4 19V5"></path>
            <path d="M4 19h16"></path>
            <path d="M7 15l3-3 3 3 6-8"></path>
          </svg>
          Segmen Otomatis (Most Replayed)
        </div>
        <div class="muted" style="margin:-4px 0 10px 0">Preview/edit per segmen sebelum diproses. Tombol Preview akan membuka modal untuk adjust start/end.</div>
        <div class="row" style="margin:0 0 10px 0">
          <button class="btn" id="segSelectAll" title="Aktifkan semua segmen." disabled>
            <span class="btnLabel">
              <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M9 11l3 3L22 4"></path>
                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
              </svg>
              <span>Select All</span>
            </span>
          </button>
          <button class="btn" id="segDeselectAll" title="Nonaktifkan semua segmen." disabled>
            <span class="btnLabel">
              <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M18 6L6 18"></path>
                <path d="M6 6l12 12"></path>
              </svg>
              <span>Deselect All</span>
            </span>
          </button>
          <div class="muted" id="segPickInfo" style="text-align:right;flex:1"></div>
        </div>
        <table class="seglist" id="segTable">
          <thead><tr><th style="width:40px">On</th><th>Start</th><th>End</th><th>Dur</th><th style="width:64px">Score</th><th style="width:130px">Aksi</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="card">
        <h2>
          <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M12 1v2"></path>
            <path d="M12 21v2"></path>
            <path d="M4.2 4.2l1.4 1.4"></path>
            <path d="M18.4 18.4l1.4 1.4"></path>
            <path d="M1 12h2"></path>
            <path d="M21 12h2"></path>
            <path d="M4.2 19.8l1.4-1.4"></path>
            <path d="M18.4 5.6l1.4-1.4"></path>
            <circle cx="12" cy="12" r="4"></circle>
          </svg>
          Output & Subtitle
        </h2>
        <div class="muted" style="margin:-6px 0 12px 0">Atur folder output, mode crop, dan opsi subtitle.</div>
        <label title="Default: ~/Videos/ClipAI atau custom path di PC ini.">Lokasi Output</label>
        <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;">
          <label style="display:flex;gap:6px;align-items:center;white-space:nowrap;flex:0 0 auto;" title="Pakai default folder."><input type="radio" name="outMode" value="default" checked /> Default</label>
          <label style="display:flex;gap:6px;align-items:center;white-space:nowrap;flex:0 0 auto;" title="Tulis path folder custom."><input type="radio" name="outMode" value="custom" /> Custom</label>
          <input id="outDir" type="text" placeholder="C:\\path\\to\\folder" title="Folder output di mesin ini." style="flex:1;min-width:200px;" />
        </div>
        <div style="height:10px"></div>
        <label title="Masukkan Gemini API Key untuk fitur saran Judul & Caption (Opsional).">Gemini API Key (AI Title & Caption)</label>
        <input id="geminiKey" type="password" placeholder="AIzaSy..." title="API Key dari Google AI Studio." autocomplete="off" />
        <div id="geminiKeyHint" class="muted" style="margin-top:6px"></div>
        <div style="height:10px"></div>
        <div class="row" style="align-items:flex-end;">
          <div style="flex:0 0 160px;">
            <label title="default=middle crop, fit=tanpa crop (pad), split untuk facecam bawah.">Crop Mode</label>
            <select id="crop">
              <option value="default">default</option>
              <option value="fit">fit (no crop)</option>
              <option value="split_left">split_left</option>
              <option value="split_right">split_right</option>
            </select>
            <label style="display:flex;gap:8px;align-items:center;margin-top:10px;white-space:nowrap;" title="Tampilkan overlay perkiraan area crop di preview."><input id="cropPrev" type="checkbox" checked /> Preview crop</label>
          </div>
          <div style="flex:1;min-width:280px;">
            <label title="Aktifkan subtitle AI (butuh download model).">Subtitle</label>
            <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
              <label style="display:flex;gap:6px;align-items:center;white-space:nowrap;"><input id="subOn" type="checkbox" /> ON</label>
              <select id="model" title="Ukuran model Faster-Whisper." style="flex:1;min-width:100px;">
                <option>tiny</option>
                <option>base</option>
                <option selected>small</option>
                <option>medium</option>
                <option>large-v3</option>
              </select>
              <select id="subLang" title="Bahasa subtitle: auto deteksi atau dipaksa." style="flex:0 0 110px;">
                <option value="auto">Auto</option>
                <option value="id" selected>ID</option>
                <option value="en">EN</option>
              </select>
              <select id="subPos" title="Posisi subtitle: bawah / tengah / atas." style="flex:0 0 90px;">
                <option value="bottom">Bawah</option>
                <option value="middle" selected>Tengah</option>
                <option value="top">Atas</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <h2>
          <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M12 5v14"></path>
            <path d="M5 12h14"></path>
          </svg>
          Tambah Segmen Manual
        </h2>
        <div class="muted" style="margin:-6px 0 12px 0">Kalau mau klip bagian tertentu, isi start/end lalu Tambah. Batas per klip: 02:59 (179 detik).</div>
        <label title="Rentang waktu klip manual (detik).">Start / End (manual)</label>
        <div class="row">
          <input id="sStart" type="number" min="0" step="1" title="Start detik." />
          <input id="sEnd" type="number" min="0" step="1" title="End detik." />
        </div>
        <div class="durMeter" id="durMeterManual" aria-live="polite"></div>
        <div style="height:10px"></div>
        <div class="row">
          <button class="btn" id="addSeg" title="Tambah segmen manual dari input start/end.">
            <span class="btnLabel">
              <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M12 5v14"></path>
                <path d="M5 12h14"></path>
              </svg>
              <span>Tambah</span>
            </span>
          </button>
          <button class="btn danger" id="clearSeg" title="Hapus semua segmen.">
            <span class="btnLabel">
              <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M3 6h18"></path>
                <path d="M8 6V4h8v2"></path>
                <path d="M19 6l-1 14H6L5 6"></path>
                <path d="M10 11v6"></path>
                <path d="M14 11v6"></path>
              </svg>
              <span>Clear</span>
            </span>
          </button>
        </div>
      </div>

      <div class="card">
        <h2>
          <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M12 2l1.8 5.2L19 9l-5.2 1.8L12 16l-1.8-5.2L5 9l5.2-1.8L12 2z"></path>
            <path d="M19 14l.9 2.6L22 18l-2.1.7L19 21l-.9-2.3L16 18l2.1-.7L19 14z"></path>
          </svg>
          Proses
        </h2>
        <div class="muted" style="margin:-6px 0 12px 0">Review dulu ringkasan, lalu proses. Progress dan log tampil di bawah.</div>
        <div class="row">
          <button class="btn primary" id="review" title="Tampilkan ringkasan dan konfirmasi sebelum proses.">
            <span class="btnLabel">
              <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M9 11l3 3L22 4"></path>
                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
              </svg>
              <span>Review & Proses</span>
            </span>
          </button>
          <button class="btn" id="openFolder" type="button" title="Buka folder output (hasil clip)." style="display:none">
            <span class="btnLabel">
              <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M3 7h6l2 2h10v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7z"></path>
                <path d="M3 7V5a2 2 0 0 1 2-2h5l2 2h7a2 2 0 0 1 2 2"></path>
              </svg>
              <span>Lihat Folder</span>
            </span>
          </button>
        </div>
        <div style="height:12px"></div>
        <div class="progress"><div class="bar" id="bar"></div></div>
        <div class="row" style="margin-top:8px">
          <div class="muted" id="status">Idle</div>
          <div class="muted" id="eta" style="text-align:right"></div>
        </div>
        <pre id="log" class="mono"></pre>
      </div>
    </div>
  </div>

  <div class="modal" id="modal">
    <div class="box">
      <h3>Konfirmasi</h3>
      <div id="summary" class="summary"></div>
      <div class="row">
        <button class="btn" id="closeModal">
          <span class="btnLabel">
            <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <path d="M7 10l5 5 5-5"></path>
              <path d="M12 15V3"></path>
            </svg>
            <span>Ubah Settings</span>
          </span>
        </button>
        <button class="btn primary" id="go">
          <span class="btnLabel">
            <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M8 5v14l11-7z"></path>
            </svg>
            <span>Proses Sekarang</span>
          </span>
        </button>
      </div>
    </div>
  </div>

  <div class="modal" id="segModal">
    <div class="box">
      <h3>Preview Heatmap</h3>
      <div class="muted" id="segMeta"></div>
      <div class="muted">Batas per klip: 02:59 (179 detik).</div>
      <div style="height:10px"></div>
      <div class="player">
        <div id="segPlayer"></div>
        <svg id="segCropOverlay" class="cropOverlay" viewBox="0 0 100 100" preserveAspectRatio="none" aria-hidden="true"></svg>
      </div>
      <div style="height:10px"></div>
      <div class="row">
        <label style="display:flex;gap:8px;align-items:center;justify-content:flex-end" title="Aktif/nonaktif segmen ini untuk diproses.">
          <input id="segEnabled" type="checkbox" />
          Enable segmen
        </label>
      </div>
      <div style="height:12px"></div>
      <h3 style="margin:0 0 10px 0">Edit Segment</h3>
      <div class="row">
        <div>
          <label title="Format: detik (123) atau MM:SS atau HH:MM:SS">Start</label>
          <input id="segEditStart" type="text" placeholder="MM:SS" />
        </div>
        <div>
          <label title="Format: detik (123) atau MM:SS atau HH:MM:SS">End</label>
          <input id="segEditEnd" type="text" placeholder="MM:SS" />
        </div>
      </div>
      <div class="durMeter" id="durMeterSeg" aria-live="polite"></div>
      <div style="height:10px"></div>
      <div class="row">
        <button class="btn" id="segSetStartNow" title="Set start = posisi player saat ini.">
          <span class="btnLabel">
            <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M12 8v8"></path>
              <path d="M8 12h8"></path>
              <circle cx="12" cy="12" r="10"></circle>
            </svg>
            <span>Set Start = Now</span>
          </span>
        </button>
        <button class="btn" id="segSetEndNow" title="Set end = posisi player saat ini.">
          <span class="btnLabel">
            <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M12 7v10"></path>
              <path d="M8 12h8"></path>
              <path d="M12 2a10 10 0 1 1 0 20"></path>
            </svg>
            <span>Set End = Now</span>
          </span>
        </button>
        <button class="btn primary" id="segApply" title="Terapkan perubahan start/end ke segmen.">
          <span class="btnLabel">
            <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M9 11l3 3L22 4"></path>
              <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
            </svg>
            <span>Apply</span>
          </span>
        </button>
      </div>
      <div style="height:12px"></div>
      <div class="row">
        <button class="btn" id="segClose">
          <span class="btnLabel">
            <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M18 6L6 18"></path>
              <path d="M6 6l12 12"></path>
            </svg>
            <span>Tutup</span>
          </span>
        </button>
        <button class="btn primary" id="segUse" title="Pakai start/end ini ke input manual.">
          <span class="btnLabel">
            <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M12 5v14"></path>
              <path d="M5 12h14"></path>
            </svg>
            <span>Pakai ke Manual</span>
          </span>
        </button>
      </div>
    </div>
  </div>

  <div class="busy" id="busy">
    <div class="box">
      <div class="busyTop">
        <span class="spinner big"></span>
        <div>
          <div class="busyTitle" id="busyTitle">Loading</div>
          <div class="busyMsg" id="busyMsg">Mohon tunggu...</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    window.__YTCLIPPER_DEFAULT_OUTDIR__ = "{{ default_output_dir }}";
  </script>
  <script src="/static/app.js"></script>
</body>
</html>
